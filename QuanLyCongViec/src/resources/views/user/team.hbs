<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <title>Team</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/user.css" />
  <link rel="stylesheet" href="/css/modal.css" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">

</head>
<style>
  
</style>
<body>
<!-- The Modal -->
    {{!-- <div id="myModal" class="modal">
      <!-- Modal content -->
      <div class="modal-content">
        <span class="close">&times;</span>
          {{#each tables}}
          {{#if column1}} 
        <div class="list-item" >
          <input class="titlebox2" type="text" name="title" placeholder="Title" style="background-color: {{this.status}};"  value="{{this.title}}" readonly/>
          <textarea class="inp" type="text" name="description" placeholder="Descriptions"  readonly>{{this.description}}</textarea>
          <div class="date"><strong>Deadline:</strong> {{this.deadline}}</div>
        </div>
        {{/if}}
        {{/each}}
      </div>
    </div>
<!-- The Modal -->
    <div id="myModal2" class="modal">
      <!-- Modal content -->
      <div class="modal-content">
        <span class="close2">&times;</span>
          {{#each tables}}
          {{#if column2}} 
        <div class="list-item" >
          <input class="titlebox2" type="text" name="title" placeholder="Title" style="background-color: {{this.status}};" value="{{this.title}}" readonly/>
          <textarea class="inp" type="text" name="description" placeholder="Descriptions"  readonly>{{this.description}}</textarea>
          <div class="date"><strong>Deadline:</strong> {{this.deadline}}</div>
        </div>
        {{/if}}
        {{/each}}
      </div>
      <br>
    </div>
<!-- The Modal -->
    <div id="myModal3" class="modal">
      <!-- Modal content -->
      <div class="modal-content">
        <span class="close3">&times;</span>
          {{#each tables}}
          {{#if column3}} 
        <div class="list-item" >
          <input class="titlebox2" type="text" name="title" placeholder="Title" style="background-color: {{this.status}};" value="{{this.title}}" readonly/>
          <textarea class="inp" type="text" name="description" placeholder="Descriptions"  readonly>{{this.description}}</textarea>
          <div class="date"><strong>Deadline:</strong> {{this.deadline}}</div>
        </div>
        {{/if}}
        {{/each}}
      </div>
    </div>
<!-- The Modal -->
    <div id="myModal4" class="modal">
      <!-- Modal content -->
      <div class="modal-content">
        <span class="close4">&times;</span>
          {{#each tables}}
          {{#if column4}} 
        <div class="list-item" >
          <input class="titlebox2" type="text" name="title" placeholder="Title" value="{{this.title}}" style="background-color: {{this.status}};" readonly/>
          <textarea class="inp" type="text" name="description" placeholder="Descriptions"  readonly>{{this.description}}</textarea>
          <div class="date"><strong>Deadline:</strong> {{this.deadline}}</div>
        </div>
        {{/if}}
        {{/each}}
      </div>
    </div> --}}


    <div class="contain-all">
      <nav>
          <input type="checkbox" id="check">
          <label for="check" class="checkbtn">
            <i class="fas fa-bars"></i>
          </label>
          <label class="logo">ScheduleX</label>
        <ul>
            <li><div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bell" viewBox="0 0 16 16">
                    <path d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2zM8 1.918l-.797.161A4.002 4.002 0 0 0 4 6c0 .628-.134 2.197-.459 3.742-.16.767-.376 1.566-.663 2.258h10.244c-.287-.692-.502-1.49-.663-2.258C12.134 8.197 12 6.628 12 6a4.002 4.002 0 0 0-3.203-3.92L8 1.917zM14.22 12c.223.447.481.801.78 1H1c.299-.199.557-.553.78-1C2.68 10.2 3 6.88 3 6c0-2.42 1.72-4.44 4.005-4.901a1 1 0 1 1 1.99 0A5.002 5.002 0 0 1 13 6c0 .88.32 4.2 1.22 6z"/>
                  </svg>               
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                  {{#each late_jobs}}
                     <div class="toast-header" style="background-color: {{1}};">
                      {{!-- <img src="..." class="rounded mr-2" alt="..."> --}}
                      <strong class="mr-auto">{{2}}: Over Deadline</strong>
                      <small>{{4}} hours ago</small>
                      {{!-- <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button> --}}
                    </div>
                    {{!-- <div class="toast-body">
                      Your task is over the deadline :
                    </div> --}}
                    <div class="dropdown-divider"></div>
                    
                  {{/each}}
                </div>
              </div>
            </li>
          <li><a class="active" id="search2" href="/user/search" ><img class="search2" src="/img/search2.png" /></a></li>
          <li><a class="active" href="/user/info">Profile</a></li>
          <li><a class="active" href="/user/team">Join team</a></li>
          <li><a class="active" href="/logout">Log out</a></li>
        </ul>
        <ul>
          <li><a href="/user"><img class="avatar" src="/img/avatar.png" alt="change your avatar"></a></li>
        </ul>
      </nav>

      <div class="toolbars">
        <button class="ADD" id="show-form1" onclick="myFunction1()">+</button>
        <button class="ADD" id="show-form2" onclick="myFunction2()">+</button>
        <button class="ADD" id="show-form3" onclick="myFunction3()">+</button>
        <button class="ADD" id="show-form4" onclick="myFunction4()">+</button>
      </div>
    

  <div class="app">
    <div class="lists">
      <div id="column1" class="list">
        <div class="titlebox2">To do</div>
        <form class="list-item" method="POST" id="form-add1" style="display: none;">
          <input type="hidden" name="column1" value="column1" >
          <input class="titlebox2" type="text" name="title" placeholder="Title"  />
          <textarea class="inp" type="text" name="description" placeholder="Descriptions"  ></textarea>
          <input class="date" name="deadline" type="datetime-local"  />
          <div class="date"><strong>Deadline:</strong></div>
          <input class="save-form" type="submit" value="SAVE" />
        </form>
        
        {{#each tables}}
        {{#if column1}}
          <form id="{{this._id}}" action="/user/team?_method=PUT" method="POST">
            <input type="hidden" name="Idtable" value="{{this._id}}">
          </form>


        <div id="{{this._id}}_column1" class="list-item" draggable="true">
          <button class="titlebox2" onclick="" style="background-color: {{this.status}};">{{this.title}}</button>               
          <form  method="POST" action="/user/edit-table-team" >
            <input type="hidden" name="Idtable" value="{{this._id}}">
            <div class="edit-btn">
              <input class="save-form" type="submit" value="Edit" />
              <input class="save-form" type="submit" value="Delete" form="{{this._id}}" />
            </div>
          </form>
        </div>
        
        {{/if}}
        {{/each}}

      </div>

      <div id="column2" class="list">
        <div class="titlebox2">In Progress</div>
       <form class="list-item" method="POST"  id="form-add2" style="display: none;">
          <input type="hidden" name="column2" value="column2" >
          <input class="titlebox2" type="text" name="title" placeholder="Title" value="{{this.title}}" />
          <textarea class="inp" type="text" name="description" placeholder="Descriptions"  >{{this.description}}</textarea>
          <input class="date" name="deadline" type="datetime-local"  />
          <div class="date"><strong>Deadline:</strong> {{this.deadline}}</div>
          <input class="save-form" type="submit" value="SAVE" />
          
        </form>
        
                {{#each tables}}
                {{#if column2}}
          <form id="{{this._id}}" action="/user/team?_method=PUT" method="POST">
            <input type="hidden" name="Idtable" value="{{this._id}}">
          </form>


        <div id="{{this._id}}_column2" class="list-item" draggable="true">
          <button class="titlebox2" onclick="" style="background-color: {{this.status}};">{{this.title}}</button>               
          <form  method="POST" action="/user/edit-table-team" >
            <input type="hidden" name="Idtable" value="{{this._id}}">
            <div class="edit-btn">
              <input class="save-form" type="submit" value="Edit" />
              <input class="save-form" type="submit" value="Delete" form="{{this._id}}" />
            </div>
          </form>
        </div>
                {{/if}}
                {{/each}}
      </div>
      
      <div id="column3" class="list">
        <div class="titlebox2">Testing</div>
          <form class="list-item" method="POST"  id="form-add3" style="display: none;">
          <input type="hidden" name="column3" value="column3" >
          <input class="titlebox2" type="text" name="title" placeholder="Title" value="{{this.title}}" />
          <textarea class="inp" type="text" name="description" placeholder="Descriptions"  >{{this.description}}</textarea>
          <input class="date" name="deadline" type="datetime-local"  />
          <div class="date"><strong>Deadline:</strong> {{this.deadline}}</div>
          <input class="save-form" type="submit" value="SAVE" />
        </form>
        
                {{#each tables}}
                {{#if column3}}
          <form id="{{this._id}}" action="/user/team?_method=PUT" method="POST">
            <input type="hidden" name="Idtable" value="{{this._id}}">
          </form>


        <div id="{{this._id}}_column3" class="list-item" draggable="true">
          <button class="titlebox2" onclick="" style="background-color: {{this.status}};">{{this.title}}</button>               
          <form  method="POST" action="/user/edit-table-team" >
            <input type="hidden" name="Idtable" value="{{this._id}}">
            <div class="edit-btn">
              <input class="save-form" type="submit" value="Edit" />
              <input class="save-form" type="submit" value="Delete" form="{{this._id}}" />
            </div>
          </form>
        </div>
                {{/if}}
                {{/each}}
      </div>
      
      <div id="column4" class="list">
        <div class="titlebox2">Done</div>
          <form class="list-item" method="POST" id="form-add4" style="display: none;">
          <input type="hidden" name="column4" value="column4" >
          <input class="titlebox2" type="text" name="title" placeholder="Title" value="{{this.title}}" />
          <textarea class="inp" type="text" name="description" placeholder="Descriptions"  >{{this.description}}</textarea>
          <input class="date" name="deadline" type="datetime-local"  />
          <div class="date"><strong>Deadline:</strong> {{this.deadline}}</div>
          <input class="save-form" type="submit" value="SAVE" />
        </form>
        
                {{#each tables}}
                {{#if column4}}
          <form id="{{this._id}}" action="/user/team?_method=PUT" method="POST">
            <input type="hidden" name="Idtable" value="{{this._id}}">
          </form>


        <div id="{{this._id}}_column4" class="list-item" draggable="true">
          <button class="titlebox2" onclick="" style="background-color: {{this.status}};">{{this.title}}</button>               
          <form  method="POST" action="/user/edit-table-team" >
            <input type="hidden" name="Idtable" value="{{this._id}}">
            <div class="edit-btn">
              <input class="save-form" type="submit" value="Edit" />
              <input class="save-form" type="submit" value="Delete" form="{{this._id}}" />
            </div>
          </form>
        </div>
                {{/if}}
                {{/each}}
      </div>
    </div>
  </div>

</div>
{{#each late_jobs}}
<div class="toast" data-autohide="false">
  <div class="toast-header">
    <strong class="mr-auto text-primary">Task: {{2}}</strong>
    <small class="text-muted">{{4}} hours ago</small>
    <button type="button" class="ml-2 mb-1 close" data-dismiss="toast">&times;</button>
  </div>
  <div class="toast-body">
    This task expired
  </div>
</div>
{{/each}}
</body>
<script>
  function handleId(id){
    var data = id.split("_")
    return data;
  }
  function createTask(item, list){
    var url = window.location.origin + "/user/dragend/" + item.id;
    var ids = handleId(item.id)
    $.ajax({
      url: url ,
      type: "POST",
      data: {
        idTable: ids[0],
        column: list.id,
        pre_column: ids[1]
      },
      success: function(result){
        console.log("created")
      }
    })
  }
</script>
<script>
  //drag
const list_items = document.querySelectorAll('.list-item');
const lists = document.querySelectorAll('.list');
console.log(list_items)
let draggedItem = null;

for (let i = 0; i < list_items.length; i++) {
	const item = list_items[i];

	item.addEventListener('dragstart', function () {
		draggedItem = item;
		setTimeout(function () {
			item.style.display = 'none';
		}, 0)
	});

	item.addEventListener('dragend', function () {
		setTimeout(function () {
			draggedItem.style.display = 'block';
			draggedItem = null;
		}, 0);
	})

	for (let j = 0; j < lists.length; j ++) {
		const list = lists[j];

		list.addEventListener('dragover', function (e) {
			e.preventDefault();
		});
		
		list.addEventListener('dragenter', function (e) {
			e.preventDefault();
			this.style.backgroundColor = 'rgba(0, 0, 0, 0.2)';
		});

		list.addEventListener('dragleave', function (e) {
			this.style.backgroundColor = 'rgba(0, 0, 0, 0.1)';
		});

		list.addEventListener('drop', function (e) {
			this.append(draggedItem);
			this.style.backgroundColor = 'rgba(0, 0, 0, 0.1)';
      createTask(draggedItem, lists[j]);
      console.log("drop")
		});
	}
}
</script>
<script>
  // Get the modal
var modal = document.getElementById("myModal");
var span = document.getElementsByClassName("close")[0];

function addtitle(){
    modal.style.display = "block";

}
// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}
  // Get the modal
var modal2 = document.getElementById("myModal2");
var span2 = document.getElementsByClassName("close2")[0];

function addtitle2(){
    modal2.style.display = "block";

}
// When the user clicks on <span> (x), close the modal
span2.onclick = function() {
  modal2.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal2) {
    modal2.style.display = "none";
  }
}
  // Get the modal
var modal3 = document.getElementById("myModal3");
var span3 = document.getElementsByClassName("close3")[0];

function addtitle3(){
    modal3.style.display = "block";

}
// When the user clicks on <span> (x), close the modal
span3.onclick = function() {
  modal3.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal3) {
    modal3.style.display = "none";
  }
}
  // Get the modal
var modal4 = document.getElementById("myModal4");
var span4 = document.getElementsByClassName("close4")[0];

function addtitle4(){
    modal4.style.display = "block";

}
// When the user clicks on <span> (x), close the modal
span4.onclick = function() {
  modal4.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal4) {
    modal4.style.display = "none";
  }
}  
</script>
<script>
  function myFunction1() {
    var formAdd1 = document.getElementById('form-add1');
    if (formAdd1.style.display === "none") {
      formAdd1.style = "";
    } else {
      formAdd1.style.display = "none";
    }
  }

  function myFunction2() {
    var formAdd2 = document.getElementById('form-add2');
    if (formAdd2.style.display === "none") {
      formAdd2.style = "";
    } else {
      formAdd2.style.display = "none";
    }
  }

  function myFunction3() {
    var formAdd3 = document.getElementById('form-add3');
    if (formAdd3.style.display === "none") {
      formAdd3.style = "";
    } else {
      formAdd3.style.display = "none";
    }
  }

  function myFunction4() {
    var formAdd4 = document.getElementById('form-add4');
    if (formAdd4.style.display === "none") {
      formAdd4.style = "";
    } else {
      formAdd4.style.display = "none";
    }
  }
  
</script>
<style>
  .dropdown-menu {
    width: 400px !important;
}
</style>
<script>
$(document).ready(function(){
  $('.toast').toast('show');
});
</script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
</html>